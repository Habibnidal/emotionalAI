<!DOCTYPE html>
<html>
<head>
  <title>Emotional AI Assistant</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }

    .container {
      background: #1e1e2f;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      padding: 40px;
      max-width: 500px;
      width: 100%;
      position: relative;
      overflow: hidden;
      z-index: 10;
      border: 1px solid #2a2a4a;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
    }

    h2 { color: #e2e8f0; font-size: 28px; margin-bottom: 24px; text-align: center; font-weight: 600; }

    .emoji { font-size: 36px; display: inline-block; animation: float 3s ease-in-out infinite; }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    textarea {
      width: 100%;
      padding: 16px;
      border: 2px solid #2a2a4a;
      border-radius: 12px;
      font-size: 15px;
      font-family: inherit;
      resize: vertical;
      transition: all 0.3s ease;
      background: #151525;
      color: #e2e8f0;
      margin-bottom: 24px;
    }

    textarea::placeholder { color: #555; }

    textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    }

    .category-label {
      display: block;
      padding: 12px 16px;
      margin-bottom: 8px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #151525;
      border: 2px solid transparent;
      position: relative;
      padding-left: 44px;
    }

    .category-label:hover { background: #1a1a35; transform: translateX(4px); }

    input[type="radio"] {
      position: absolute;
      left: 16px; top: 50%;
      transform: translateY(-50%);
      width: 18px; height: 18px;
      cursor: pointer;
      accent-color: #667eea;
    }

    input[type="radio"]:checked + .category-text { color: #667eea; font-weight: 600; }

    .category-label:has(input:checked) { background: rgba(102, 126, 234, 0.1); border-color: #667eea; }

    .category-text { color: #8892b0; font-size: 15px; transition: all 0.2s ease; }

    .categories { margin-bottom: 20px; }

    .language-selection { display: flex; gap: 10px; margin-bottom: 28px; }

    .language-selection .category-label { flex: 1; text-align: center; padding-left: 16px; }

    .language-selection input[type="radio"] { display: none; }

    button {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.35);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    button:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(102, 126, 234, 0.5); }
    button:active { transform: translateY(0); }

    .loading { display: none; text-align: center; margin-top: 20px; }
    .loading.show { display: block; }

    .loading-dots span {
      display: inline-block;
      width: 8px; height: 8px;
      border-radius: 50%;
      background: #667eea;
      margin: 0 3px;
      animation: bounce 1.4s ease-in-out infinite;
    }

    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }

    /* Character container - slightly larger */
    .character-container {
      position: fixed;
      right: -450px;
      bottom: 40px;
      width: 360px;
      transition: right 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1000;
    }

    .character-container.show { right: 30px; }

    .image-wrapper {
      position: relative;
      width: 260px;
      height: 370px;
      margin: 0 auto;
      animation: float 3s ease-in-out infinite;
    }

    /* Bluish glowing border effect */
    .character-video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 20px;
      border: 2px solid rgba(102, 126, 234, 0.6);
      box-shadow: 
        0 0 15px rgba(102, 126, 234, 0.4),
        0 0 30px rgba(102, 126, 234, 0.2),
        inset 0 0 15px rgba(102, 126, 234, 0.1);
    }

    @keyframes glowPulse {
      0%, 100% {
        box-shadow: 
          0 0 15px rgba(102, 126, 234, 0.4),
          0 0 30px rgba(102, 126, 234, 0.2),
          inset 0 0 15px rgba(102, 126, 234, 0.1);
        border-color: rgba(102, 126, 234, 0.6);
      }
      50% {
        box-shadow: 
          0 0 20px rgba(102, 126, 234, 0.6),
          0 0 40px rgba(102, 126, 234, 0.3),
          inset 0 0 20px rgba(102, 126, 234, 0.15);
        border-color: rgba(102, 126, 234, 0.8);
      }
    }

    .character-video.speaking {
      animation: glowPulse 2s ease-in-out infinite;
    }

    /* Mouth overlay - positioned at bottom center of character */
    

    /* Speech bubble */
    .speech-bubble {
      position: absolute;
      left: -280px;
      top: 10px;
      max-width: 250px;
      background: #1e1e2f;
      padding: 16px 20px;
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      border: 1px solid #2a2a4a;
      opacity: 0;
      transform: scale(0.8);
      transition: all 0.4s ease;
    }

    .speech-bubble.show { opacity: 1; transform: scale(1); }

    .speech-bubble::after {
      content: '';
      position: absolute;
      right: -10px;
      top: 30px;
      width: 0; height: 0;
      border-left: 15px solid #1e1e2f;
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent;
    }

    .speech-bubble-text { color: #e2e8f0; font-size: 14px; line-height: 1.6; }

    @media (max-width: 900px) {
      .character-container { display: none; }
      .container { max-width: 100%; }
    }

    @media (max-width: 600px) {
      .container { padding: 24px; }
      h2 { font-size: 24px; }
    }
    .bot-name {
  position: absolute;
  top: -35px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 22px;
  font-weight: 700;
  letter-spacing: 1px;
  padding: 6px 18px;
  border-radius: 12px;
  background: #151525;
  border: 2px solid rgba(102, 126, 234, 0.6);
  color: #e2e8f0;
  overflow: hidden;
}

/* Light sweep layer */
.bot-name::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 200%;
  height: 100%;
  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(102, 126, 234, 0.2) 30%,
    rgba(102, 126, 234, 0.9) 50%,
    rgba(102, 126, 234, 0.2) 70%,
    transparent 100%
  );
  transform: skewX(-20deg);
}

/* Animate ONLY when speaking */
.bot-name.speaking::before {
  animation: moveGlow 2s linear infinite;
}

@keyframes moveGlow {
  0% { left: -100%; }
  100% { left: 100%; }
}

  </style>
</head>
<body>

<div class="container">
  <h2><span class="emoji">ðŸ¤–</span> Emotional AI Assistant</h2>

  <textarea id="text" rows="5" placeholder="Describe what you are feeling..."></textarea>

  <div class="categories">
    <label class="category-label">
      <input type="radio" name="cat" value="current condition">
      <span class="category-text">Current Condition</span>
    </label>
    <label class="category-label">
      <input type="radio" name="cat" value="strength">
      <span class="category-text">Strength</span>
    </label>
    <label class="category-label">
      <input type="radio" name="cat" value="weakness">
      <span class="category-text">Weakness</span>
    </label>
    <label class="category-label">
      <input type="radio" name="cat" value="motivational advice">
      <span class="category-text">Motivational Advice</span>
    </label>
    <label class="category-label">
      <input type="radio" name="cat" value="what should i do now">
      <span class="category-text">What should I do now</span>
    </label>
    <label class="category-label">
      <input type="radio" name="cat" value="better living">
      <span class="category-text"> What to do for Better Living</span>
    </label>
  </div>

  <div class="language-selection">
    <label class="category-label">
      <input type="radio" name="language" value="en" checked>
      <span class="category-text">ðŸ‡ºðŸ‡¸ English</span>
    </label>
    <label class="category-label">
      <input type="radio" name="language" value="ml">
      <span class="category-text">ðŸ‡®ðŸ‡³ à´®à´²à´¯à´¾à´³à´‚</span>
    </label>
  </div>

  <button onclick="send()">Check</button>

  <div class="loading" id="loading">
    <div class="loading-dots">
      <span></span><span></span><span></span>
    </div>
  </div>
</div>

<!-- Character Panel -->
<div class="character-container" id="characterContainer">
  <div class="speech-bubble" id="speechBubble">
    <div class="speech-bubble-text" id="speechText"></div>
  </div>

  <div class="image-wrapper">
    <div class="bot-name" id="botName">Veloria</div><br>
    <video class="character-video" id="characterVideo" loop muted playsinline autoplay
           src="IMG_8261.MP4.webm"></video>

    <!-- <div class="mouth-overlay">
      <div class="mouth-shape" id="mouthShape"></div>
    </div> -->
  </div>
</div>

<script>
const mouth = document.getElementById('mouthShape');
const video = document.getElementById('characterVideo');

function startTalking() {
  video.classList.add('speaking');
}

function stopTalking() {
  video.classList.remove('speaking');
}
function hideCharacter() {
  document.getElementById('characterContainer').classList.remove('show');
  document.getElementById('speechBubble').classList.remove('show');
}

function speakText(text, language) {
  window.speechSynthesis.cancel();
  const msg = new SpeechSynthesisUtterance(text);
  const voices = window.speechSynthesis.getVoices();

  if (language === 'ml') {
    msg.lang = 'ml-IN'; msg.rate = 0.85; msg.pitch = 1.15;
    const v = voices.find(v => v.lang.includes('ml')) || voices.find(v => v.lang.includes('hi-IN')) || voices[0];
    if (v) msg.voice = v;
  } else {
    msg.lang = 'en-US'; msg.pitch = 1.5; msg.rate = 5.0;
    const v = voices.find(v => v.lang.includes('en') && (v.name.toLowerCase().includes('david') || v.name.toLowerCase().includes('alex')));
    if (v) msg.voice = v;
  }

  msg.onstart = startTalking;
  msg.onend = stopTalking;
  msg.onerror = stopTalking;

  try { window.speechSynthesis.speak(msg); } catch(e) { stopTalking(); }
}

function send() {
  const text = document.getElementById('text').value;
  const cat = document.querySelector('input[name="cat"]:checked');
  const lang = document.querySelector('input[name="language"]:checked');

  if (!text.trim()) { alert('Please describe your feelings'); return; }
  if (!cat) { alert('Please select a category'); return; }

  const language = lang ? lang.value : 'en';

  document.getElementById('loading').classList.add('show');
  document.getElementById('characterContainer').classList.remove('show');
  document.getElementById('speechBubble').classList.remove('show');
  stopTalking();

  fetch("https://emotionalai.onrender.com/analyze", {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text, category: cat.value, language })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById('loading').classList.remove('show');
    document.getElementById('characterContainer').classList.add('show');
    document.getElementById('speechText').textContent = data.response;
    document.getElementById('speechBubble').classList.add('show');

    if (data.audio) {
      const audio = new Audio('data:audio/mp3;base64,' + data.audio);
      audio.playbackRate = 1.3;
      audio.preservesPitch = true;
      audio.onplay = startTalking;
      audio.onended = () => {
        stopTalking();
        hideCharacter();
      };
      audio.onerror = () => {
        stopTalking();
        hideCharacter();
      };
      audio.play();
    } else {
      speakText(data.response, language);
    }
  })
  .catch(() => {
    document.getElementById('loading').classList.remove('show');
    stopTalking();
    alert('Error connecting to the server. Please try again.');
  });
}

window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
</script>
</body>
</html>
